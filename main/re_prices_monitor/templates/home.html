{% extends 'base.html' %}

{% block content %}
<!-- {% load static %} -->

<div class="App">

    <header class="App-header">
        <img src="{% static 'images/django-logo.png' %}" class="App-logo" alt="logo" />
        <h3>Welcome in Real Estate Prices Monitor Application</h3>
    </header>

    <section>
        <form method="post" class="Select-Menus-Box" onchange="submit()">
            {% csrf_token %}

            <div class="Single-Select-Box">
                <h4> {{ form.city.label_tag }} </h4>
                {{ form.city }}
            </div>
            <div class="Single-Select-Box">
                <h4> {{ form.market.label_tag }} </h4>
                {{ form.market }}
            </div>
            <div class="Single-Select-Box">
                <h4> {{ form.data_type.label_tag }} </h4>
                {{ form.data_type }}
            </div>
            <!-- <button type="submit" class="btn btn-primary">Submit</button> -->
        </form>
    </section>

    
    <section>
        
        <h4>Average Prices Trend</h4>
        <canvas id="Price-Trend-Chart" width="400" height="200"></canvas>
        
    </section>


    <section>
        <h4>Average prices and informations from last scraping</h4>
        <table class='table table-striped table-bordered table-hover'>
            <thead>
                <tr>
                    <th>Pos.</th>
                    <th>Data</th>
                    <th>City</th>
                    <th>Market</th>
                    <th>Price m2</th>               
                    <th>Total price</th>
                    <th>Rooms</th>
                    <th>Area</th>
                </tr>
            </thead>
            <tbody>
                {% for offer in latest_offers %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ offer.date }}</td>
                        <td>{{ offer.city_name }}</td>
                        <td>{{ offer.market_type }}</td>
                        <td>{{ offer.m2_price }}</td>
                        <td>{{ offer.total_price }}</td>
                        <td>{{ offer.rooms }}</td>
                        <td>{{ offer.area }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>


</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

    const data = JSON.parse('{{ chart_data|safe|escapejs }}');

    let ctx = document.getElementById("Price-Trend-Chart").getContext("2d");

    let chart = new Chart(ctx, {
    type: "line",
    data: data.data,
    
    });


</script>

{% endblock %}


